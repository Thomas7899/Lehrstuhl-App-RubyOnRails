<% content_for :title, "KI-Assistent" %>

<div class="chatbot-container">
  
  <!-- HEADER -->
  <header class="chatbot-header d-flex justify-content-between align-items-center">
    <div>
      <h2 class="mb-1">
        <i class="bi bi-robot me-2"></i>Lehrstuhl KI-Assistent
      </h2>
      <p class="text-muted mb-0">
        <i class="bi bi-chat-dots me-1"></i>
        Ihr intelligenter Helfer fÃ¼r alle Fragen rund um den Lehrstuhl
      </p>
    </div>

    <div class="chatbot-actions d-flex align-items-center gap-2">
      <button type="button" class="btn btn-outline-secondary btn-sm" id="clearChatBtn">
        <i class="bi bi-trash me-1"></i>Verlauf lÃ¶schen
      </button>
      <div class="chatbot-status d-flex align-items-center gap-1">
        <span class="status-indicator online"></span>
        <small>Online</small>
      </div>
    </div>
  </header>

  <!-- CHAT AREA -->
  <main class="chatbot-body flex-grow-1 d-flex flex-column">
    <div class="chatbot-messages flex-grow-1" id="chatMessages">
      <div class="welcome-message">
        <div class="assistant-message">
          <div class="message-avatar"><i class="bi bi-robot"></i></div>
          <div class="message-content">
            <div class="message-bubble assistant">
              <p class="mb-2"><strong>Willkommen!</strong> ğŸ‘‹</p>
              <p class="mb-2">Ich bin Ihr KI-Assistent und helfe Ihnen gerne bei:</p>
              <ul class="mb-2">
                <li>ğŸ“š Fragen zu Abschlussarbeiten</li>
                <li>ğŸ‘¥ Studierenden-Verwaltung</li>
                <li>ğŸ” Navigation durch die App</li>
                <li>ğŸ“Š Datenanalyse und Berichte</li>
                <li>ğŸ’¡ Allgemeine Beratung</li>
              </ul>
              <p class="mb-0"><em>Stellen Sie mir einfach Ihre Frage!</em></p>
            </div>
            <div class="message-time"><%= Time.current.strftime('%H:%M') %></div>
          </div>
        </div>
      </div>

      <% @chat_messages.each do |message| %>
        <div class="<%= message.is_from_user? ? 'user-message' : 'assistant-message' %>">
          <div class="message-avatar">
            <i class="bi bi-<%= message.is_from_user? ? 'person-circle' : 'robot' %>"></i>
          </div>
          <div class="message-content">
            <div class="message-bubble <%= message.role %>"><%= simple_format(message.content) %></div>
            <div class="message-time"><%= message.formatted_timestamp %></div>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Typing indicator -->
    <div class="typing-indicator" id="typingIndicator" style="display: none;">
      <div class="assistant-message">
        <div class="message-avatar"><i class="bi bi-robot"></i></div>
        <div class="message-content">
          <div class="message-bubble assistant typing">
            <div class="typing-dots"><span></span><span></span><span></span></div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- INPUT AREA -->
  <footer class="chatbot-input">
    <form id="chatForm" class="d-flex" data-turbo="false" onsubmit="return false;">
      <div class="input-group">
        <input type="text" class="form-control" id="messageInput"
               placeholder="Ihre Frage an den KI-Assistenten..."
               autocomplete="off" maxlength="1000">
        <button type="submit" class="btn btn-primary" id="sendBtn">
          <i class="bi bi-send-fill"></i>
          <span class="d-none d-sm-inline ms-1">Senden</span>
        </button>
      </div>
    </form>

    <div class="quick-actions mt-3 d-flex flex-wrap align-items-center gap-2">
      <small class="text-muted me-2">Schnelle Fragen:</small>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Wie erstelle ich eine neue Abschlussarbeit?">
        <i class="bi bi-plus-circle me-1"></i>Neue Arbeit
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Wie finde ich andere Studierende in der App?">
        <i class="bi bi-search me-1"></i>Suche
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Welche Abschlussarbeiten sind thematisch nah an Medizin?">
        <i class="bi bi-journal-text me-1"></i>Abstrakte Arbeiten
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Wurden bereits konkrete Abschlussarbeiten Ã¼ber Robotik verfasst?">
        <i class="bi bi-journal-check me-1"></i>Konkrete Arbeiten
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Ich suche ein Seminar, das sich mit ethischen Fragestellungen beschÃ¤ftigt.">
        <i class="bi bi-collection me-1"></i>Abstrakte Seminare
      </button>
      <button type="button" class="btn btn-sm btn-outline-primary quick-question" data-question="Welche Klausuren sind vorhanden?">
        <i class="bi bi-file-earmark-text me-1"></i>Klausuren
      </button>
    </div>
  </footer>

</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
  <div id="errorToast" class="toast" role="alert">
    <div class="toast-header">
      <i class="bi bi-exclamation-triangle-fill text-warning me-2"></i>
      <strong class="me-auto">Fehler</strong>
      <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body" id="errorMessage">Ein Fehler ist aufgetreten.</div>
  </div>
</div>
